import java.awt.*;
import javax.swing.*;
import javax.swing.event.*;
import java.awt.event.*;
import java.sql.*;
import net.sourceforge.jdatepicker.impl.JDatePanelImpl;
import net.sourceforge.jdatepicker.impl.JDatePickerImpl;
import net.sourceforge.jdatepicker.impl.UtilDateModel;

public class MainFrame extends JFrame {
	
	JPanel panel = new JPanel(new FlowLayout());
	JPanel calPanel = new JPanel(new FlowLayout());
	JLabel info = new JLabel("üëàüèªÎã¨Î†•");
	JTextArea typeTxt = new JTextArea();
	JButton save = new JButton("Ï†ÄÏû•");
	UtilDateModel model = new UtilDateModel();
	
	MainFrame(){
		
		setTitle("ÎπÑÎ∞Ä Îã§Ïù¥Ïñ¥Î¶¨");
		setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
		setContentPane(panel);
		JDatePanelImpl datePanel = new JDatePanelImpl(model);
		JDatePickerImpl datePicker = new JDatePickerImpl(datePanel);
		
		panel.add(datePicker);
		panel.add(info);
		panel.add(typeTxt);
		panel.add(save);
		
		typeTxt.setPreferredSize(new Dimension(280,280));
		save.setPreferredSize(new Dimension(60,40));
		info.setPreferredSize(new Dimension(60,40));
		
		MyActionListener ml = new MyActionListener();
		save.addActionListener(ml);
		
		setSize(300,400);
		datePicker.setBounds(300,300,400,400);
		setResizable(false);
		
		Dimension frameSize = this.getSize();
		Dimension screenSize = Toolkit.getDefaultToolkit().getScreenSize();
		this.setLocation((screenSize.width - frameSize.width) / 2, (screenSize.height - frameSize.height) / 2);
	}
	
	class MyActionListener implements ActionListener{
		public void actionPerformed(ActionEvent e) {
			JButton b = (JButton) e.getSource();
			if(b.getText().equals("Ï†ÄÏû•")) {
				String date = model.getYear()+"/"+(model.getMonth()+1)+"/"+model.getDay();
				String content = typeTxt.getText();
				saveDiary(date, content);
			}
		}
	}
	
	void saveDiary (String _s, String _ss) {
		String date = _s;
		String content = _ss;
		
		AES256 aes256 = new AES256();
		
		Connection con = null;
		Statement stmt = null;
		String url = "jdbc:mysql://localhost:3306/Diary?serverTimezone=Asia/Seoul";
		String user = "root";
		String passwd = "1234";
		
		try {
			Class.forName("com.mysql.cj.jdbc.Driver");
		} catch(java.lang.ClassNotFoundException e) {
			System.err.print("ClassNotFoundException: "); 
			System.err.println(e.getMessage());
			return;
		}
		
		String insertString = "INSERT INTO diary (date, content) VALUES ";

		try {
			String passString = insertString + "('"+ date +"', '"+ aes256.encrypt(content) + "' )";
			con = DriverManager.getConnection(url, user, passwd);	
			stmt = con.createStatement();
			stmt.executeUpdate(passString);
			System.out.println("insert finished");
			typeTxt.setText("");
	
		} catch(Exception ex) {
			System.err.println("SQLException: " + ex.getMessage());
		}
		finally {
        		try {
        			if (stmt != null) stmt.close();
                	if (con != null) con.close();
               	} catch (Exception e) {}
      	 	}
		
	}
}
